<div class="auth carbonCustom" id="change_password">
    <div class="cds--row cds--no-gutter">
        <div class="cds--col-lg-5 cds--col-md-0 cds--col-sm-0">
            <div class="left-image">
                <img src="images/background.svg">
            </div>
        </div>
        <div class="cds--col-sm-12 cds--col-md-12 cds--col-lg-11 d-flex">
            <div class="content-box cds--col-md-5 cds--col-lg-8">
                <img src="images/Mexedia.svg">
                <h2 class="weight-700">Nuova password</h2>
                <p class="subh3 text-color-grey weight-600">Digita e salva la nuova password.</p>
                <form action="{{ui.action}}" method="{{ui.method}}">
                    <bx-form-item>
                        {{#each ui.nodes}}
                        {{#if (eq attributes.name "csrf_token")}}
                        {{> (toUiNodePartial .)}}
                        {{/if}}
                        {{/each}}
                        <bx-input placeholder="Inserisci la nuova password" size="lg" color-scheme="" name="password"
                            type="password" required minlength="8">
                            <span class="customText" slot="label-text">Nuova password</span>
                            <span slot="helper-text">Almeno 8 caratteri, una maiuscola, un numero e un carattere
                                speciale.</span>
                        </bx-input>

                        <bx-input placeholder="Inserisci la nuova password" size="lg" color-scheme="" type="password"
                            name="confirm-password" required minlength="8">
                            <span class="customText" slot="label-text">Ripeti nuova password</span>
                            <div class="error-message"></div>
                        </bx-input>

                        <bx-btn type="submit" name="method" value="password" class="mt-7" icon-layout> Salva password
                        </bx-btn>
                        <a class="mt-10" href="mailto:support@mexedia.com">Contatta l'assistenza</a>
                    </bx-form-item>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    window.onload = () => {
        const errorMessages = document.getElementsByClassName('error-message')
        for (e of errorMessages) {
            e.style.display = 'none'
        }

        const form = document.querySelector("form")
        const button = form.querySelector("[type=submit]")

        const method = document.createElement("input")
        method.setAttribute("type", "hidden")
        if (button.getAttribute("name")) {
            method.setAttribute("name", button.getAttribute("name"))
            method.setAttribute("value", button.getAttribute("value"))
        }
        form.appendChild(method)

        button.addEventListener("click", () => {
            const formData = new FormData(form)
            const event = new CustomEvent("formdata", {
                bubbles: true,
                cancelable: false,
                composed: false,
            })

            const confirmPasswordInput = document.querySelector('[name="confirm-password"]')
            const errorMessage = document.getElementsByClassName('error-message')[0]
            if (formData.get('passord') !== formData.get('confirm-password')) {
                confirmPasswordInput.valid = false;
                errorMessage.innerHTML = "Le password inserite non corrispondono.";
            } else {
                confirmPasswordInput.valid = true;
                errorMessage.innerHTML = ""
            }

            event.formData = formData
            form.dispatchEvent(event)
            form.submit();
        })

        const passwordField = document.querySelector("[name='confirm-password']")
        passwordField.addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                document.querySelector("[type=submit]").click()
            }
        })
    }
</script>